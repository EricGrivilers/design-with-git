<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>gh3</title>
    
</head>
<body>
	<div>
		<label>Github user : </label>
  		<input type="text" value="xuv" id="userName" title="Github user name"/>
  		<label>repository : </label>
		<input type="text" value="svg-git-dummy" id="repositoryName" title="Github repository name" />
		<input type="button" value="Get Repository" onclick='getRep()' />
	</div>
	<div>
		<ul id="filesList">
		</ul>
	</div>

</body>
<script src="http://code.jquery.com/jquery-1.9.1.js"></script>
<script src="js/underscore.js"></script>
<script src="js/base64.js"></script>
<script src="js/gh3.js"></script>
<script>

	
	var filesList = $("#filesList");

	var files = [];

	var getRep = function(){
		var ghUser = new Gh3.User($("#userName")[0].value );
		var ghRepository = new Gh3.Repository($("#repositoryName")[0].value, ghUser);
		ghRepository.fetch(function (err, res) {
			ghRepository.fetchBranches(function (err, res) {
		  		res.eachBranch( function(branch){
		  			// console.dir(branch);
		  			branch.fetchContents(function (err, res) {
						if(err) { throw "outch ..." }
						res.eachContent(function (content) {
							if (( content.type === "file" ) &&
							( content.name.substring(content.name.lastIndexOf(".")) === '.svg' )) {
								var svgFile = content;
								console.log(files.length);
								if (files.length === 0 ) {
									files.push(svgFile);
									filesList.append("<input type=\"button\" value=\"Get File\" " + "onclick=\"getFile('" + svgFile.name +  "')\" /> " + svgFile.name + "<br>");
								} else {
									for(i = 0; i < files.length; i++){
										console.log
										if (svgFile.name != files[i].name){
											files.push(svgFile);
											filesList.append("<input type=\"button\" value=\"Get File\" " + "onclick=\"getFile('" + svgFile.name +  "')\" /> " + svgFile.name + "<br>");
										}
									}
								}
							}
						});
					});
				});
			});
		});
	};

	var getFileCommitHistoryData = function( svgFile ) {
		svgFile.fetchCommits(function (err, res) {
	        if(err) { throw "outch ..." }

	        svgFile.eachCommit(function (commit) {
	        	console.dir(commit);

	            $.getJSON( commit.url, function(data) {
	            	
	            	$.getJSON( data.files[0].contents_url, function(svg_e){
	            			var svg = Base64.decode(svg_e.content);
	            			console.dir(svg);
	            			/*
	            			rawContent.append(
			            		'<li>' +
			            		data.commit.author.name + ' says:  "' +
			            		data.commit.message +'" at ' +
			            		data.commit.author.date + '<br>' +
			            		svg
			            	);
							*/
	            		});
	            	

					 // console.log(data.commit.author.name, data.commit.message, data.commit.author.date, data.files[0].raw_url );
				});
	        });
		});
	}


	var getFile = function(fileName){
		for (i=0; i < files.length; i++){
			if (files[i].name === fileName ){
				files[i].fetchContent(function (err, res) {
					if(err) { throw "outch ..." }
					getFileCommitHistoryData(files[i]);
				});
				break;
			}
		}
	};

		
</script>
</html>
