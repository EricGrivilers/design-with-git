<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>gh3</title>  
</head>
<body>
	<h1></h1>
	<h2></h2>
	<ul></ul>
	<div id="textarea"></div>
</body>
<script src="http://code.jquery.com/jquery-1.9.1.js"></script>
<script src="js/base64.js"></script>
<script src="js/underscore.js"></script>
<script src="js/gh3.js"></script>

<script>

	var
	 xuv = new Gh3.User("xuv")
	,	repoTitle = $("h1")
	,	branchTitle = $("h2")
	,	branchContents = $("ul")
	,	rawContent = $("#textarea");

	var timelineData = {};

	var svgGitDummy = new Gh3.Repository("svg-git-dummy", xuv);

	var getFileCommitHistoryData = function( svgFile ) {
		svgFile.fetchCommits(function (err, res) {
	        if(err) { throw "outch ..." }

	        svgFile.eachCommit(function (commit) {
	        	console.dir(commit);

	            $.getJSON( commit.url, function(data) {
	            	
	            	$.getJSON( data.files[0].contents_url, function(svg_e){
	            			var svg = Base64.decode(svg_e.content);

	            			rawContent.append(
			            		'<li>' +
			            		data.commit.author.name + ' says:  "' +
			            		data.commit.message +'" at ' +
			            		data.commit.author.date + '<br>' +
			            		svg
			            	);
	            		});
	            	

					 // console.log(data.commit.author.name, data.commit.message, data.commit.author.date, data.files[0].raw_url );
				});
	        });
		});
	}

	svgGitDummy.fetch(function (err, res) {
		if(err) { throw "outch ..." }
		repoTitle.html(svgGitDummy.full_name);

		svgGitDummy.fetchBranches(function (err, res) {
			if(err) { throw "outch ..." }

			console.log("Res branches");
			console.dir(res);

			$.each(res.branches, function(i, branch){
				var name = branch.name;
				
				rawContent.append('<ul><li>' + name + '</li>');

				branch.fetchContents(function (err, res) {
					if(err) { throw "outch ..." }
					branch.eachContent(function (content) {
						if (( content.type === "file" ) &&
							( content.name.substring(content.name.lastIndexOf(".")) === '.svg' )) {
						
							var svgFile = content;
							console.dir(svgFile);

							// getFileCommitHistoryData(svgFile);
						}
					});
				});
			});
			/*
			svgGitDummy.eachBranch(function (branch) {
				branch.fetchContents(function (err, res) {
					if(err) { throw "outch ..." }

					console.log(branch.name);

					branch.eachContent(function (content) {
						if (( content.type === "file" ) &&
							( content.name.substring(content.name.lastIndexOf(".")) === '.svg' )) {
						
							var svgFile = content;
							//console.log(svgFile);

							getFileCommitHistoryData(svgFile);
						}
					});
				});
			});
			*/	
		});
	});
		
</script>
</html>
